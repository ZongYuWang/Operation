## 视音频编解码技术

### 1、生活中的视音频技术

平时我们打开电脑中自己存电影的目录的话，一般都会如下图所示，一大堆五花八门的电影

![](https://github.com/ZongYuWang/image/blob/master/%E6%B5%81%E5%AA%92%E4%BD%93/Audio-video-coding1.png)

&emsp;&emsp;因为下载的来源不同，这些电影文件有不同的格式，用不同的后缀表示：avi、rmvb、mp4、flv、mkv等（当然也使用不同的图标），在这里需要注意的是，这些格式代表的是封装格式       
&emsp;&emsp;仅仅靠看文件的后缀，很难能看出具体使用了什么视音频编码标准。总的来说，不同的封装格式之间差距不大，各有优劣。

### 2、封装格式：
&emsp;&emsp;就是把视频数据和音频数据打包成一个文件的规范    
&emsp;&emsp;有些封装格式支持的视音频编码标准十分广泛，应该算比较优秀的封装格式，比如MKV；而有些封装格式支持的视音频编码标准很少，应该属于落后的封装格式，比如RMVB         


| 名称 | 推出机构 | 流媒体 | 支持的视频编码 | 支持的音频编码 | 目前使用领域 |
| - | :- | :- | :- | :- | :- |
| AVI | Microsoft Inc.| 不支持 | 几乎所有格式 | 几乎所有格式 | BT下载影视 |
| MP4 | MPEG | 支持 | MPEG-2, MPEG-4, H.264, H.263等 | AAC, MPEG-1 Layers I, II, III, AC-3等 | 互联网视频网站 |
| TS |MPEG |  支持  | MPEG-1, MPEG-2, MPEG-4, H.264 | MPEG-1 Layers I, II, III, AAC, | IPTV，数字电视 |
| FLV | Adobe Inc. |  支持 | Sorenson, VP6, H.264 | MP3, ADPCM, Linear PCM, AAC等 | 互联网视频网站 |
| MKV | CoreCodec Inc. |  支持 | 几乎所有格式 | 几乎所有格式 |互联网视频网站 |
| RMVB | Real Networks Inc. |  支持 | RealVideo 8, 9, 10 | AAC, Cook Codec, RealAudio Lossless |BT下载影视|        

&emsp;&emsp;除了AVI之外，其他封装格式都支持流媒体，即可以“边下边播”。有些格式更“万能”一些，支持的视音频编码标准多一些，比如MKV。而有些格式则支持的相对比较少，比如说RMVB


### 3、视频编码
&emsp;&emsp;视频编码的主要作用是将视频像素数据（RGB，YUV等）压缩成为视频码流，从而降低视频的数据量。如果视频不经过压缩编码的话，体积通常是非常大的，一部电影可能就要上百G的空间。视频编码是视音频技术中最重要的技术之一。视频码流的数据量占了视音频总数据量的绝大部分。高效率的视频编码在同等的码率下，可以获得更高的视频质量        

| 名称 | 推出机构 | 推出时间 | 目前使用领域 |
| :- | :- | :- | :- | 
| HEVC(H.265) | MPEG/ITU-T| 2013 | 研发中|
| H.264 | MPEG/ITU-T | 2003 | 各个领域 |
| MPEG4 | MPEG | 2001 | 不温不火 |
| MPEG2 | MPEG | 1994 | 数字电视 |
| VP9 | Google| 2013 | 研发中 |
| VP8 | Google | 2008 | 不普及 |
| VC-1 | Microsoft Inc. | 2006 | 微软平台 |       

&emsp;&emsp;有两种视频编码方案是最新推出的：VP9和HEVC。目前这两种方案都处于研发阶段，还没有到达实用的程度。当前使用最多的视频编码方案就是H.264

### 4、音频编码
&emsp;&emsp;音频编码的主要作用是将音频采样数据（PCM等）压缩成为音频码流，从而降低音频的数据量。一般情况下音频的数据量要远小于视频的数据量，因而即使使用稍微落后的音频编码标准，而导致音频数据量有所增加，也不会对视音频的总数据量产生太大的影响。高效率的音频编码在同等的码率下，可以获得更高的音质        

| 名称 | 推出机构 | 推出时间 | 目前使用领域 |
| :- | :- | :- | :- | 
| AAC | MPEG| 1997 | 各个领域(新)|
| AC-3 | Dolby Inc. | 1992 | 电影 |
| MP3 | MPEG | 1993 | 各个领域(旧) |
| WMA | Microsoft Inc. | 1999 | 微软平台 |             


`音质比较：AAC+ > MP3PRO > AAC> RealAudio > WMA > MP3`

### 5、通过MediaInfo查看一个视频文件采用的视音频技术

![](https://github.com/ZongYuWang/image/blob/master/%E6%B5%81%E5%AA%92%E4%BD%93/Audio-video-coding2.png)

"低俗小说.mkv"采用Matroska封装格式，采用了AVC(H.264)的压缩编码标准

这里使用了一个查看媒体信息的工具：MediaInfo，MediaInfo是一个专门查看视音频格式的工具，[软件的详细使用可参考](MediaInfo使用了解)

### 6、视频播放器原理
&emsp;&emsp;视音频技术主要包含以下几点：封装技术，视频压缩编码技术以及音频压缩编码技术，如果考虑到网络传输的话，还包括流媒体协议技术

#### 3.1 视频播放器播放本地的视频文件
需要经过解封装、解码视音频、视音频同步等几个步骤

#### 3.2 视频播放器播放互联网上的视频文件
需要经过解协议、解封装、解码视音频、视音频同步等几个步骤

![](https://github.com/ZongYuWang/image/blob/master/%E6%B5%81%E5%AA%92%E4%BD%93/Audio-video-coding3.png)


**解协议**的作用，就是将流媒体协议的数据，解析为标准的相应的封装格式数据。视音频在网络上传播的时候，常常采用各种流媒体协议，例如HTTP，RTMP，或是MMS等。这些协议在传输视音频数据的同时，也会传输一些信令数据。这些信令数据包括对播放的控制（播放，暂停，停止），或者对网络状态的描述等。解协议的过程中会去除掉信令数据而只保留视音频数据。例如，采用RTMP协议传输的数据，经过解协议操作后，输出FLV格式的数据。

**解封装**的作用，就是将输入的封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据。封装格式种类很多，例如MP4，MKV，RMVB，TS，FLV，AVI等等，它的作用就是将已经压缩编码的视频数据和音频数据按照一定的格式放到一起。例如，FLV格式的数据，经过解封装操作后，输出H.264编码的视频码流和AAC编码的音频码流。

**解码**的作用，就是将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据。音频的压缩编码标准包含AAC，MP3，AC-3等等，视频的压缩编码标准则包含H.264，MPEG2，VC-1等等。解码是整个系统中最重要也是最复杂的一个环节。通过解码，压缩编码的视频数据输出成为非压缩的颜色数据，例如YUV420P，RGB等等；压缩编码的音频数据输出成为非压缩的音频抽样数据，例如PCM数据。

**视音频同步**的作用，就是根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来。

[封装格式对比](http://en.wikipedia.org/wiki/Comparison_of_container_formats)      
[视频编码器对比](http://en.wikipedia.org/wiki/Comparison_of_audio_formats)       
[音频编码格式对比](http://en.wikipedia.org/wiki/Comparison_of_audio_formats)       
[视频播放器对比](http://en.wikipedia.org/wiki/Comparison_of_video_player_software)      